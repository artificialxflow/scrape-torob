# چک‌لیست جامع ساخت و توسعه پروژه اسکریپر ترب (Torob Scraper)

این فایل راهنمای کامل و عملیاتی برای ساخت، توسعه و دیپلوی پروژه اسکریپر دسته‌بندی ترب با Next.js و Node.js است. هر مرحله با جزییات و نکات فنی نوشته شده تا بتوانید پروژه را از صفر بازسازی کنید.

---

## ساختار پیشنهادی پروژه

```
project/
├── app/
│   ├── api/
│   │   └── scrape/route.js      # API Route برای اسکرپینگ
│   ├── page.tsx                # صفحه اصلی و فرانت
│   ├── layout.tsx              # چیدمان و راست‌چین کل سایت
│   └── ...
├── components/                 # کامپوننت‌های فرانت (در صورت نیاز)
├── public/                     # تصاویر و فایل‌های استاتیک
├── postman/                    # کالکشن‌های Postman برای تست API
├── styles/
│   ├── custom.scss             # سفارشی‌سازی Bootstrap (در صورت نیاز)
│   └── variables.scss          # تغییر متغیرهای Bootstrap (در صورت نیاز)
├── scrape.js                   # اسکریپت Node.js مستقل برای اسکرپینگ
├── debug.html                  # خروجی HTML برای دیباگ اسکرپینگ
├── todo.md                     # همین چک‌لیست
├── README.md                   # مستندات پروژه
├── package.json
├── package-lock.json
└── ...
```

---

## فاز ۱: آماده‌سازی و نصب وابستگی‌ها
- [x] نصب Node.js (LTS)
- [x] نصب ویرایشگر (VS Code)
- [x] ایجاد پروژه Next.js (App Router)
  - [x] npx create-next-app@latest
  - [x] انتخاب جاوااسکریپت (بدون TypeScript)
  - [x] حذف محتوای پیش‌فرض public و صفحات
- [x] نصب Bootstrap و راه‌اندازی global
  - [x] npm i bootstrap
  - [x] ایمپورت در layout.tsx و page.tsx
- [x] نصب Puppeteer و ابزارهای ضد ربات
  - [x] npm i puppeteer puppeteer-extra puppeteer-extra-plugin-stealth
- [x] ساخت پوشه postman و افزودن کالکشن تست API

---

## فاز ۲: پیاده‌سازی بک‌اند (اسکریپت و API)
- [x] ساخت scrape.js (اسکریپت Node.js مستقل)
  - [x] راه‌اندازی Puppeteer Extra + Stealth
  - [x] دریافت URL از argv
  - [x] باز کردن صفحه، اسکرول خودکار، صبر برای لود کامل
  - [x] استخراج محصولات (نام، قیمت، فروشگاه، لینک، تصویر، آگهی)
  - [x] ذخیره debug.html برای دیباگ
  - [x] خروجی JSON محصولات
- [x] ساخت API Route (app/api/scrape/route.js)
  - [x] دریافت POST با url
  - [x] اجرای scrape.js با child_process
  - [x] بازگرداندن خروجی scrape.js به کلاینت
  - [x] مدیریت خطا و ارسال پیام مناسب

---

## فاز ۳: پیاده‌سازی فرانت‌اند (صفحه اصلی)
- [x] تبدیل page.tsx به Client Component
- [x] ساخت فرم ورودی URL با Bootstrap
- [x] مدیریت state (url, loading, error, result)
- [x] ارسال درخواست به API و نمایش لودینگ
- [x] نمایش خطاها و پیام‌ها
- [x] نمایش نتایج محصولات با کارت Bootstrap
  - [x] نمایش تصویر محصول (یا آیکون جایگزین)
  - [x] نمایش نام، قیمت، فروشگاه، آگهی
  - [x] دکمه مشاهده در ترب
  - [x] استایل جذاب، راست‌چین، ریسپانسیو
- [x] بهبود تجربه کاربری (spinner, badge, رنگ‌بندی)

---

## فاز ۴: تست و دیباگ
- [x] اجرای پروژه با `npm run dev`
- [x] تست API با Postman (کالکشن آماده در postman/)
- [x] تست با URLهای مختلف دسته‌بندی ترب
- [x] بررسی debug.html برای صحت استخراج
- [x] بررسی کنسول مرورگر و لاگ سرور
- [x] رفع خطاهای احتمالی (selector, anti-bot, ...)

---

## فاز ۵: قابلیت‌های پیشرفته (در صورت نیاز)
- [ ] کراول چند صفحه‌ای و مدیریت صفحه‌بندی
- [ ] خروجی CSV و Google Sheets
- [ ] زمان‌بندی اتوماتیک (node-cron)
- [ ] دیپلوی سرورلس (Vercel/Netlify)
- [ ] بهینه‌سازی سرعت و کشینگ
- [ ] مدیریت پروکسی و IP در Puppeteer

---

## نکات امنیتی و فنی
- [x] استفاده از .env برای متغیرهای حساس (در صورت نیاز)
- [x] عدم ذخیره اطلاعات حساس در ریپو
- [x] اعتبارسنجی ورودی‌ها در API
- [x] مدیریت خطا و ارسال پیام مناسب به کلاینت
- [x] رعایت robots.txt و قوانین سایت ترب
- [x] مستندسازی کامل در README.md و todo.md

---

## راهنمای اجرا و توسعه
1. `npm install` برای نصب وابستگی‌ها
2. اجرای پروژه: `npm run dev`
3. تست API با Postman (فایل postman/torob-scraper.postman_collection.json را ایمپورت کن)
4. برای دیباگ اسکرپینگ، فایل debug.html را بررسی کن
5. برای توسعه بیشتر، مراحل todo.md را دنبال کن

---

## چک‌لیست گام‌به‌گام (قابل تیک زدن)
- [x] نصب و راه‌اندازی پروژه Next.js
- [x] نصب Bootstrap و راه‌اندازی استایل
- [x] نصب Puppeteer و ابزارهای ضد ربات
- [x] ساخت اسکریپت scrape.js و تست استخراج محصولات
- [x] ساخت API Route و اتصال به scrape.js
- [x] ساخت فرم و نمایش نتایج در فرانت
- [x] تست کامل با Postman و مرورگر
- [x] بهبود استایل و تجربه کاربری
- [x] مستندسازی و آماده‌سازی برای توسعه بعدی

---

## نکات مهم برای بازتولید پروژه
- همیشه selectorها را با inspect صفحه اصلی ترب چک کن (ممکن است تغییر کند)
- اگر تصاویر محصولات نمایش داده نشد، منطق استخراج img را بهبود بده
- برای دیپلوی سرورلس، از puppeteer-core و chromium سفارشی استفاده کن
- اگر سایت کپچا یا anti-bot نشان داد، از پروکسی یا سرویس‌های حل کپچا استفاده کن
- همیشه فایل todo.md و README.md را به‌روز نگه دار

---

**این فایل را به عنوان مرجع اصلی توسعه و بازتولید پروژه نگه دار و هر تغییر مهمی را در آن ثبت کن.** 